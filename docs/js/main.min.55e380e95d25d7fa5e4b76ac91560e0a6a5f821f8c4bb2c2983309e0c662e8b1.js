;(function($){'use strict'
$(document).ready(function(){const CURRENT_LANGUAGE=$('html').attr('lang')
const $searchInput=$('.cp-search-bar-field')
if($searchInput&&$searchInput.length){$searchInput.data('html',true)
$searchInput.data('placement','bottom')
$searchInput.data('template','<div class="popover offline-search-result" role="tooltip"><div class="arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>')
$searchInput.on('change',event=>{render($(event.target))
$searchInput.blur()})
$searchInput.closest('form').on('submit',()=>{return false})
let idx=null
const resultDetails=new Map()
$.ajax($searchInput.data('offline-search-index-json-src')).then(data=>{idx=lunr(function(){this.ref('ref')
this.field('title',{boost:5})
this.field('description',{boost:2})
this.field('body')
this.field('language')
data.forEach(doc=>{this.add(doc)
resultDetails.set(doc.ref,{title:doc.title,excerpt:doc.excerpt,language:doc.language})})})
$searchInput.trigger('change')})
const render=$targetSearchInput=>{$('.cp-search-results').remove()
if(idx===null){return}
const searchQuery=$targetSearchInput.val()
if(searchQuery===''){return}
const results=idx.query(q=>{const tokens=lunr.tokenizer(searchQuery.toLowerCase())
tokens.forEach(token=>{const queryString=token.toString()
q.term(queryString,{boost:100})
q.term(queryString,{wildcard:lunr.Query.wildcard.LEADING|lunr.Query.wildcard.TRAILING,boost:10})
q.term(queryString,{editDistance:2})})}).slice(0,$targetSearchInput.data('offline-search-max-results'))
const $html=$('<div class="cp-search-results">')
const $searchResultBody=$('<div class="cp-search-results-found">')
$('.cp-search').append($html)
$html.append($searchResultBody)
if(results.length===0){$searchResultBody.append($('<p>').text(`No results found for query "${searchQuery}"`))}else{results.forEach((r,index)=>{if(index<=3){const doc=resultDetails.get(r.ref)
const baseURL=$searchInput.data('offline-search-base-href')
const href=baseURL+r.ref.replace(/^\//,'')
const $entry=$('<div>').addClass('row justify-content-between align-items-center cp-search-results-found-item')
$entry.append($('<span>').addClass('col-auto cp-search-results-found-item-title').text(doc.title))
$entry.append($('<span>').addClass('col-auto').append(`<a href="${r.ref}"><img src="${baseURL}/icons/arrow-right.svg" alt="Ir"></a>`))
$searchResultBody.append($entry)}})}
const handleSearchReset=()=>{$targetSearchInput.val('')
$targetSearchInput.trigger('change')}
$('.cp-search-bar-button').on('click',()=>{handleSearchReset()})
$(document).keydown(function(e){if(e.keyCode==27){handleSearchReset()}})
$(document).click(event=>{if(!$(event.target).closest('.cp-search').length){handleSearchReset()}})}}})})(jQuery)